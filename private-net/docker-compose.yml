version: '2'

# geth Private Network
# Start with: docker-compose up -d

networks:
  geth-private:
    driver: bridge
    ipam:
     config:
       - subnet: 172.19.0.0/16
         gateway: 172.19.0.1
         
services:
  bootnode: # Cannot be Scaled
    build: 
      context: ..
      dockerfile: ./private-net/Dockerfile.preBuilt
    image: geth-private-net
    ports:
      - "8545:8545"
    env_file: .env
    networks:
      geth-private:
        # Hard Coded Port for Static Node Connection
        ipv4_address: 172.19.0.2
    volumes: # Volume in the Password File and Keystore
      - ./files/password.txt:/password.txt:ro
      - ./keystore:/root/.ethereum/keystore:ro
    command: >
      --nodekeyhex $BOOTNODE_KEY_HEX 
      --unlock $UNLOCKED_ACCOUNTS 
      --password /password.txt
      --nodiscover
  miner: # Can be Scaled: docker-compose up --scale miner=5
    depends_on: 
      - bootnode
    image: geth-private-net
    ports:
      - "8545"
    env_file: .env
    networks:
      geth-private:
    volumes:
      - ./files/static-nodes.json:/root/.ethereum/geth/static-nodes.json:ro
    command: >
      --mine 
      --minerthreads=1 
      --etherbase $ETHERBASE
  # node: # Can be Scaled: docker-compose up --scale node=5
  #   depends_on:
  #     - bootnode
  #   image: geth-private-net
  #   ports:
  #     - "8545"
  #   env_file: .env
  #   networks:
  #     geth-private:
  #   volumes:
  #     - ./files/static-nodes.json:/root/.ethereum/geth/static-nodes.json:ro
